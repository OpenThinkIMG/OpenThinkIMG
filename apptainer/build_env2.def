# # 指定基础镜像的来源是 Docker Hub
# Bootstrap: docker
# From: pytorch/pytorch:2.0.1-cuda11.7-cudnn8-runtime

Bootstrap: localimage
From: /mnt/petrelfs/songmingyang/code/reasoning/tool-agent/apptainer/toolserver.sif



# %files 段落：将主机本地文件复制到容器内部
# 格式：<本地路径> <容器内路径>
%files
    # ./requirements.txt /tmp/requirements.txt
    ../ /app/tool-agent/

    # 模型权重，请自己改
    /mnt/petrelfs/share_data/songmingyang/model/mm/tools/Molmo-7B-D-0924 /weights/Molmo-7B-D-0924
    /mnt/petrelfs/songmingyang/songmingyang/model/mm/tools/sam2-hiera-large/  /weights/sam2-hiera-large/
    /mnt/petrelfs/songmingyang/songmingyang/model/mm/groundingdino_official/groundingdino_swint_ogc.pth /weights/groundingdino_swint_ogc.pth
    /mnt/petrelfs/songmingyang/code/reasoning/tool-agent/src/GroundingDINO/groundingdino/config/GroundingDINO_SwinT_OGC.py /weights/GroundingDINO_SwinT_OGC.py

%post
    mkdir -p /log


# %environment 段落：设置容器启动时可用的环境变量
%environment
    export PYTHONUNBUFFERED=1 

# %runscript 段落：定义使用 'apptainer run' 命令时默认执行的脚本
%runscript
    echo "Starting Tool Server Image"
    python /app/tool-agent/tool_server/tool_workers/scripts/launch_scripts/start_server_local.py --config \
    /app/tool-agent/tool_server/tool_workers/scripts/launch_scripts/config/service_apptainer.yaml

# %labels 段落：为镜像添加元数据标签
%labels
    Maintainer "Mingyang Song <mysong23@m.fudan.edu.cn>"
    Version "1.0.0"
    Description "Tool Server Image"